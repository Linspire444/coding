jobs:
  deploy:
    steps:
      - name: Autenticar no Supabase
        run: npx supabase link --project-ref "${{ secrets.SUPABASE_PROJECT_REF }}"
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}

      - name: Debug DATABASE_URL
        run: echo "DATABASE_URL=${{ secrets.DATABASE_URL }}"

      - name: Deploy das migrações do banco de dados
        run: npx supabase db push
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

      - name: Deploy das funções e storage
        run: npx supabase functions deploy --all
